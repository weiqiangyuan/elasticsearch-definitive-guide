[[children-agg]]
=== 子文档聚合

在父-子文档中，支持
http://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-children-aggregation.html[子文档聚合]，这一点和((("aggregations", "children aggregation")))((("children aggregation")))((("parent-child relationship", "children aggregation"))) <<nested-aggregation>> 类似。但是，对于父文档的聚合查询是不支持的（和 `reverse_nested` 类似）。

如下查询展示了如何在不同国家下，按照雇员爱好的维度进行聚合查询：
[source,json]
-------------------------
GET /company/branch/_search
{
  "size" : 0,
  "aggs": {
    "country": {
      "terms": { <1>
        "field": "country"
      },
      "aggs": {
        "employees": {
          "children": { <2>
            "type": "employee"
          },
          "aggs": {
            "hobby": {
              "terms": { <3>
                "field": "hobby"
              }
            }
          }
        }
      }
    }
  }
}
-------------------------
<1> `country` 是 `branch` 的一个字段。
<2> 对子文档的聚合查询结果和对父文档的聚合查询结果，是通过 `employee` type 关联起来的。
<3> `hobby` 是 `employee` 子文档的一个字段。
